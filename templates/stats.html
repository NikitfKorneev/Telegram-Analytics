<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ | Semantic Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/welcome.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .stats-content {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
        }
        .plot-container {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .plot-img {
            max-width: 100%;
            height: auto;
        }
        .stat-card {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .history-item:hover {
            background-color: #f8f9fa;
        }
        .telegram-status {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .telegram-status.available {
            background-color: #d4edda;
            color: #155724;
        }
        .telegram-status.unavailable {
            background-color: #f8d7da;
            color: #721c24;
        }
        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .user-card {
            background: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }

        .user-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .user-card[data-role="admin"]::before {
            background-color: #dc3545;
        }

        .user-card[data-role="user"]::before {
            background-color: #28a745;
        }

        .user-card[data-role="userplus"]::before {
            background-color: #007bff;
        }

        .user-card[data-role="none"]::before {
            background-color: #6c757d;
        }
        
        .user-info {
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 15px;
            margin-bottom: 15px;
            padding-left: 10px;
        }

        .user-info .role-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            margin-left: 10px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .role-badge.admin {
            background-color: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        .role-badge.user {
            background-color: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .role-badge.userplus {
            background-color: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }

        .role-badge.none {
            background-color: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }
        
        .user-info h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .user-info p {
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .role-select {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .permissions-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .permissions-list h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .permission-badge {
            margin-right: 5px;
            margin-bottom: 5px;
            padding: 5px 10px;
            font-size: 0.9em;
        }

        .btn-danger {
            width: 100%;
            margin-top: 10px;
        }

        /* Dark theme styles */
        body.dark-theme .user-card {
            background: #2d2d2d;
            border-color: #444;
        }

        body.dark-theme .user-info {
            border-color: #444;
        }

        body.dark-theme .user-info h3 {
            color: #ffffff;
        }

        body.dark-theme .user-info p {
            color: #adb5bd;
        }

        body.dark-theme .role-select,
        body.dark-theme .permissions-list {
            background: #1a1a1a;
        }

        body.dark-theme .permissions-list h4 {
            color: #ffffff;
        }

        body.dark-theme .form-select {
            background-color: #2d2d2d;
            color: #ffffff;
            border-color: #444;
        }

        body.dark-theme .form-select:focus {
            background-color: #2d2d2d;
            color: #ffffff;
        }

        body.dark-theme .history-item:hover {
            background-color: #333 !important;
            color: #fff !important;
        }

        body.dark-theme .role-badge {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Admin panel styles */
        .admin-content {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
        }
        
        .user-card {
            background: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .user-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .user-card[data-role="admin"]::before {
            background-color: #dc3545;
        }

        .user-card[data-role="user"]::before {
            background-color: #28a745;
        }

        .user-card[data-role="userplus"]::before {
            background-color: #007bff;
        }

        .user-card[data-role="none"]::before {
            background-color: #6c757d;
        }
        
        .user-info {
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 15px;
            margin-bottom: 15px;
            padding-left: 10px;
        }

        .user-info .role-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            margin-left: 10px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .role-badge.admin {
            background-color: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        .role-badge.user {
            background-color: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .role-badge.userplus {
            background-color: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }

        .role-badge.none {
            background-color: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }
        
        .user-info h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .user-info p {
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .role-select {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .permissions-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .permissions-list h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        /* Dark theme styles for admin panel */
        body.dark-theme .user-card {
            background: #2d2d2d;
            border-color: #444;
        }
        
        body.dark-theme .user-info {
            border-color: #444;
        }
        
        body.dark-theme .user-info h3 {
            color: #ffffff;
        }
        
        body.dark-theme .user-info p {
            color: #adb5bd;
        }

        body.dark-theme .role-badge {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-theme .role-select,
        body.dark-theme .permissions-list {
            background: #1a1a1a;
        }

        /* Custom modal styles */
        .modal-dialog {
            max-width: none !important;
            width: 1200px !important;
            min-width: 1200px !important;
        }
        .modal-content {
            width: 100% !important;
            min-width: 100% !important;
            height: 800px !important;
        }
        @media (max-width: 1300px) {
            .modal-dialog {
                width: 98vw !important;
                min-width: 98vw !important;
            }
            .modal-content {
                width: 100vw !important;
                min-width: 100vw !important;
            }
        }

        .modal-body {
            height: calc(100% - 120px); /* –í—ã—á–∏—Ç–∞–µ–º –≤—ã—Å–æ—Ç—É header –∏ footer */
            overflow-y: auto;
        }

        .modal-header, .modal-footer {
            width: 100%;
        }

        .tab-content {
            height: 100%;
        }

        .tab-pane {
            height: 100%;
        }

        #analysisForm, #changePasswordForm {
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .history-list {
            height: 100%;
            overflow-y: auto;
        }

        /* Dark theme styles */
        body.dark-theme {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        body.dark-theme .plot-container,
        body.dark-theme .stat-card {
            background: #2d2d2d;
            color: #ffffff;
        }

        body.dark-theme .card {
            background: #2d2d2d;
            color: #ffffff;
        }

        body.dark-theme .modal-content {
            background: #2d2d2d;
            color: #ffffff;
        }

        body.dark-theme .nav-tabs .nav-link {
            color: #ffffff;
        }

        body.dark-theme .nav-tabs .nav-link.active {
            background-color: #2d2d2d;
            color: #ffffff;
            border-color: #dee2e6 #dee2e6 #2d2d2d;
        }

        body.dark-theme .form-control {
            background-color: #1a1a1a;
            color: #ffffff;
            border-color: #444;
        }

        body.dark-theme .form-control:focus {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        body.dark-theme .history-item:hover {
            background-color: #333 !important;
            color: #fff !important;
        }

        /* Password change form styles */
        #changePasswordForm {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }
        
        #changePasswordForm .form-label {
            color: #2c3e50;
            font-weight: 500;
        }
        
        #changePasswordForm .form-control {
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 10px;
        }
        
        #changePasswordForm .form-control:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        
        /* Dark theme styles for password form */
        body.dark-theme #changePasswordForm .form-label {
            color: #ffffff;
        }
        
        body.dark-theme #changePasswordForm .form-control {
            background-color: #2d2d2d;
            color: #ffffff;
            border-color: #444;
        }
        
        body.dark-theme #changePasswordForm .form-control:focus {
            background-color: #2d2d2d;
            color: #ffffff;
            border-color: #80bdff;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <a href="/" style="text-decoration: none; color: inherit;">Semantic Analysis</a>
        </div>
        <div class="auth-buttons">
            <a href="/welcome" class="btn-secondary">–ù–∞–∑–∞–¥</a>
            <a href="/download_pdf" class="btn-secondary">–°–∫–∞—á–∞—Ç—å PDF</a>
            <a href="#" class="btn-secondary" data-bs-toggle="modal" data-bs-target="#changeDataModal">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            <button id="theme-toggle" class="btn-theme">üåô</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="stats-content">
        <h1 class="text-center mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h1>
        <div class="telegram-status {{ 'available' if telegram_available else 'unavailable' }}">
            <p class="mb-0">
                {% if telegram_available %}
                    Telegram –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
                {% else %}
                    Telegram –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
                {% endif %}
            </p>
        </div>

        <div class="stat-card">
            <h3>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <p>–í—Å–µ–≥–æ —Å–ª–æ–≤: {{ word_count }}</p>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
        <div class="row mt-4">
            <div class="col-12">
                <h3>–ê–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                <div class="row">
                    <!-- –ì—Ä–∞—Ñ–∏–∫ 1: –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –¥–Ω—è–º -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –¥–Ω—è–º</h5>
                                <img src="data:image/png;base64,{{ plot0 }}" class="img-fluid" alt="–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –¥–Ω—è–º">
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ì—Ä–∞—Ñ–∏–∫ 2: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —á–∞—Å–∞–º -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —á–∞—Å–∞–º —Å—É—Ç–æ–∫</h5>
                                <img src="data:image/png;base64,{{ plot1 }}" class="img-fluid" alt="–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —á–∞—Å–∞–º">
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ì—Ä–∞—Ñ–∏–∫ 3: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π</h5>
                                <img src="data:image/png;base64,{{ plot2 }}" class="img-fluid" alt="–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π">
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ì—Ä–∞—Ñ–∏–∫ 4: –¢–æ–ø-10 –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">–¢–æ–ø-10 —Å–∞–º—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h5>
                                <img src="data:image/png;base64,{{ plot3 }}" class="img-fluid" alt="–¢–æ–ø-10 –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤">
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ì—Ä–∞—Ñ–∏–∫ 5: –û–±–ª–∞–∫–æ —Å–ª–æ–≤ -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">–û–±–ª–∞–∫–æ —Å–ª–æ–≤</h5>
                                <img src="data:image/png;base64,{{ plot4 }}" class="img-fluid" alt="–û–±–ª–∞–∫–æ —Å–ª–æ–≤">
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ì—Ä–∞—Ñ–∏–∫ 6: –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ–∫—Ä–∞—Å -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ–∫—Ä–∞—Å —Å–æ–æ–±—â–µ–Ω–∏–π</h5>
                                <img src="data:image/png;base64,{{ plot5 }}" class="img-fluid" alt="–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ–∫—Ä–∞—Å">
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ì—Ä–∞—Ñ–∏–∫ 7: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å–ª–æ–≤ -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å–ª–æ–≤</h5>
                                <img src="data:image/png;base64,{{ plot6 }}" class="img-fluid" alt="–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å–ª–æ–≤">
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ì—Ä–∞—Ñ–∏–∫ 8: –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏</h5>
                                <img src="data:image/png;base64,{{ plot7 }}" class="img-fluid" alt="–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏">
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ì—Ä–∞—Ñ–∏–∫ 9: –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è–º</h5>
                                <img src="data:image/png;base64,{{ plot8 }}" class="img-fluid" alt="–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π">
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ì—Ä–∞—Ñ–∏–∫ 10: –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫</h5>
                                <img src="data:image/png;base64,{{ plot9 }}" class="img-fluid" alt="–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 Semantic Analysis. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    </footer>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
    <div class="modal fade" id="changeDataModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="analysis-tab" data-bs-toggle="tab" data-bs-target="#analysis" type="button" role="tab" aria-controls="analysis" aria-selected="true">–ê–Ω–∞–ª–∏–∑</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab" aria-controls="history" aria-selected="false">–ò—Å—Ç–æ—Ä–∏—è</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="password-tab" data-bs-toggle="tab" data-bs-target="#password" type="button" role="tab" aria-controls="password" aria-selected="false">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</button>
                        </li>
                        <li class="nav-item" role="presentation" id="adminTab" style="display: none;">
                            <button class="nav-link" id="admin-tab" data-bs-toggle="tab" data-bs-target="#admin" type="button" role="tab" aria-controls="admin" aria-selected="false">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="analysis" role="tabpanel" aria-labelledby="analysis-tab">
                            <form id="analysisForm">
                                <div class="mb-3">
                                    <label for="min_word_length" class="form-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–ª–æ–≤–∞</label>
                                    <input type="number" class="form-control" id="min_word_length" value="5" min="1">
                                </div>
                                <div class="mb-3">
                                    <label for="start_date" class="form-label">–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞</label>
                                    <input type="date" class="form-control" id="start_date">
                                </div>
                                <div class="mb-3">
                                    <label for="end_date" class="form-label">–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞</label>
                                    <input type="date" class="form-control" id="end_date">
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">
                            <div class="history-list" id="historyList">
                                <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—Ä–∏–∏ -->
                            </div>
                        </div>
                        <div class="tab-pane fade" id="password" role="tabpanel" aria-labelledby="password-tab">
                            <form id="changePasswordForm">
                                <div class="mb-3">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                                <div class="mb-3">
                                    <label for="currentPassword" class="form-label">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                                    <input type="password" class="form-control" id="currentPassword" required>
                                </div>
                                <div class="mb-3">
                                    <label for="newPassword" class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                                    <input type="password" class="form-control" id="newPassword" required>
                                </div>
                                <div class="mb-3">
                                    <label for="confirmNewPassword" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                                    <input type="password" class="form-control" id="confirmNewPassword" required>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="admin" role="tabpanel" aria-labelledby="admin-tab">
                            <div class="admin-content">
                                <h2 class="text-center mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                                <div id="usersList">
                                    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" id="applyChanges">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/script.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function changeUserRole(userId, newRole) {
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏
                const response = await fetch(`/auth/users/${userId}?role_id=${newRole}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                }

                // –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const updatedUserResponse = await fetch(`/auth/users/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (!updatedUserResponse.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                }

                const updatedUser = await updatedUserResponse.json();
                
                // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userCard = document.querySelector(`[data-user-id="${userId}"]`);
                if (userCard) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç data-role
                    userCard.setAttribute('data-role', updatedUser.role?.name?.toLowerCase() || 'none');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂ —Ä–æ–ª–∏
                    const roleBadge = userCard.querySelector('.role-badge');
                    if (roleBadge) {
                        roleBadge.className = `role-badge ${updatedUser.role?.name?.toLowerCase() || 'none'}`;
                        roleBadge.textContent = updatedUser.role?.name || '–ù–µ—Ç —Ä–æ–ª–∏';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
                    const permissionsList = userCard.querySelector('.permissions-list div');
                    if (permissionsList) {
                        permissionsList.innerHTML = updatedUser.role?.permissions ? 
                            updatedUser.role.permissions.map(p => 
                                `<span class="badge bg-primary permission-badge">${p.name}</span>`
                            ).join('') : 
                            '–ù–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–µ–ª–µ–∫—Ç–µ
                    const roleSelect = userCard.querySelector(`#role-${userId}`);
                    if (roleSelect) {
                        roleSelect.value = updatedUser.role_id;
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                alert(error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadUsers() {
            try {
                const response = await fetch('/auth/users/', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
                }
                
                const users = await response.json();
                const usersList = document.getElementById('usersList');
                usersList.innerHTML = '';
                
                users.forEach(user => {
                    const userCard = document.createElement('div');
                    userCard.className = 'user-card';
                    const roleName = user.role ? user.role.name.toLowerCase() : 'none';
                    userCard.setAttribute('data-role', roleName);
                    userCard.setAttribute('data-user-id', user.id);
                    
                    const roleBadgeClass = `role-badge ${roleName}`;
                    const roleDisplayName = user.role ? user.role.name : '–ë–µ–∑ —Ä–æ–ª–∏';
                    
                    userCard.innerHTML = `
                        <div class="user-info">
                            <h3>
                                ${user.username}
                                <span class="${roleBadgeClass}">${roleDisplayName}</span>
                            </h3>
                            <p>Email: ${user.email}</p>
                        </div>
                        <div class="role-select">
                            <label for="role-${user.id}" class="form-label">–ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å:</label>
                            <select class="form-select" id="role-${user.id}" onchange="changeUserRole(${user.id}, this.value)">
                                <option value="1" ${user.role_id === 1 ? 'selected' : ''}>Admin</option>
                                <option value="2" ${user.role_id === 2 ? 'selected' : ''}>User</option>
                                <option value="3" ${user.role_id === 3 ? 'selected' : ''}>UserPlus</option>
                            </select>
                        </div>
                        <div class="permissions-list">
                            <h4>–†–∞–∑—Ä–µ—à–µ–Ω–∏—è:</h4>
                            <div>
                                ${user.role && user.role.permissions ? 
                                    user.role.permissions.map(p => 
                                        `<span class="badge bg-primary permission-badge">${p.name}</span>`
                                    ).join('') : 
                                    '–ù–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π'}
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-warning w-100 mb-2" onclick="resetUserPassword(${user.id})">–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                            <button class="btn btn-danger w-100" onclick="deleteUser(${user.id})">–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                        </div>
                    `;
                    usersList.appendChild(userCard);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                alert(error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function resetUserPassword(userId) {
            const newPassword = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:');
            if (!newPassword) return;

            try {
                const response = await fetch(`/auth/users/${userId}/reset-password`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ new_password: newPassword })
                });
                
                if (!response.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                }
                
                alert('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–±—Ä–æ—à–µ–Ω');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è:', error);
                alert(error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function deleteUser(userId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) return;

            try {
                const response = await fetch(`/auth/users/${userId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                }
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                loadUsers();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                alert(error.message);
            }
        }

        // –ü–æ–ª—É—á–∞–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        let currentUserId = null;
        async function getCurrentUserId() {
            try {
                const response = await fetch('/auth/users/me', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    currentUserId = user.id;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', getCurrentUserId);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        async function checkAdminAccess() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    document.getElementById('adminTab').style.display = 'none';
                    return;
                }
                
                const response = await fetch('/auth/users/', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    document.getElementById('adminTab').style.display = 'block';
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
                    document.getElementById('admin-tab').addEventListener('shown.bs.tab', loadUsers);
                } else {
                    document.getElementById('adminTab').style.display = 'none';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:', error);
                document.getElementById('adminTab').style.display = 'none';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.addEventListener('DOMContentLoaded', checkAdminAccess);
        document.getElementById('changeDataModal').addEventListener('show.bs.modal', checkAdminAccess);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
        async function loadHistory() {
            try {
                const response = await fetch('/get_history_list');
                const history = await response.json();
                const historyList = document.getElementById('historyList');
                historyList.innerHTML = '';
                
                history.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'history-item';
                    div.innerHTML = `
                        <div class="d-flex justify-content-between">
                            <span>${new Date(item.timestamp).toLocaleString()}</span>
                            <span>${item.filename}</span>
                        </div>
                    `;
                    div.onclick = () => loadHistoryItem(item.id);
                    historyList.appendChild(div);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏
        async function loadHistoryItem(id) {
            try {
                const response = await fetch(`/load_history/${id}`);
                if (response.ok) {
                    window.location.reload();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏:', error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        document.getElementById('applyChanges').addEventListener('click', async () => {
            const activeTab = document.querySelector('.tab-pane.active');
            
            if (activeTab.id === 'analysis') {
                const minWordLength = document.getElementById('min_word_length').value;
                const startDate = document.getElementById('start_date').value;
                const endDate = document.getElementById('end_date').value;

                try {
                    const response = await fetch('/update_analysis', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            min_word_length: parseInt(minWordLength),
                            start_date: startDate,
                            end_date: endDate
                        })
                    });

                    if (response.ok) {
                        window.location.reload();
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
                }
            } else if (activeTab.id === 'password') {
                const email = document.getElementById('email').value;
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmNewPassword = document.getElementById('confirmNewPassword').value;

                if (newPassword !== confirmNewPassword) {
                    alert('–ù–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                    return;
                }

                try {
                    const response = await fetch('/change_password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            email: email,
                            current_password: currentPassword,
                            new_password: newPassword
                        })
                    });

                    if (response.ok) {
                        alert('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω');
                        window.location.reload();
                    } else {
                        const data = await response.json();
                        alert(data.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è');
                }
            }
        });

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
        document.getElementById('history-tab').addEventListener('shown.bs.tab', loadHistory);

        // –£–¥–∞–ª—è–µ–º —Ç–æ–∫–µ–Ω –∏–∑ localStorage –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
        document.getElementById('logoutButton').addEventListener('click', function() {
            localStorage.removeItem('token');
            localStorage.removeItem('username');
            window.location.reload();
        });
    </script>
</body>
</html>